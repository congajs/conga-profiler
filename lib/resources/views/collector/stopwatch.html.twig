<div id="stopwatch"></div>

<script type="text/javascript">

    var svg;
    var container = document.getElementById('stopwatch');
    var timeline = new Stopwatch([
        ({{ request.collectedData['Stopwatch']|json_encode }}),
        ({{ request.collectedData['Stopwatch Global']|json_encode }})
    ]);

    // output the timeline to the console for debug
    console.log('stopwatch timeline', timeline);

    // update the width function to evaluate our layout before we render
    timeline.setConfig({
        fnWidth: function() {
            var style = window.getComputedStyle(document.querySelector('#content > .content'));
            return document.body.offsetWidth
                    - document.getElementById('sidebar').offsetWidth
                    - parseInt(style && style.getPropertyValue('padding-left') || 0, 10)
                    - parseInt(style && style.getPropertyValue('padding-right') || 0, 10)
                    - parseInt(style && style.getPropertyValue('margin-left') || 0, 10)
                    - parseInt(style && style.getPropertyValue('margin-right') || 0, 10);
        }
    });

    d3.select(window).on('load.stopwatch_timeline', function(evt) {
        svg = timeline.render().node();

        while (container.firstChild) {
            container.removeChild(container.firstChild);
        }

        container.appendChild(svg);
    });

    d3.select(window).on('resize.stopwatch_timeline', function(evt) {
        svg.remove();
        svg = timeline.render().node();
        while (container.firstChild) {
            container.removeChild(container.firstChild);
        }
        container.appendChild(svg);
    });

</script>